---
id: 1234
title: Check disk space and sent email .vbs
author: Stefano Marzorati
layout: post
guid: http://ubbunti.wordpress.com/?p=1234
permalink: /check-disk-space-sent-email/
publicize_twitter_user:
  - marzorati_ste
  - marzorati_ste
authorsure_include_css:
  - 
dsq_thread_id:
  - 1925217364
categories:
  - Windows
tags:
  - disk
  - script
  - space
  - vbs
  - Windows
---
&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8217;  
&#8216;This VBScript is compiled and modified by kerneled  
&#8217;23 August 2010  
&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8221;&#8217;

strComputer = &#8220;.&#8221;  
Set objWMIService = GetObject(&#8220;winmgmts:&#8221; _  
& &#8220;{impersonationLevel=impersonate}!\&#8221; & strComputer & &#8220;rootcimv2&#8243;)  
Set colDisks = objWMIService.ExecQuery _  
(&#8220;Select * from Win32_LogicalDisk Where DeviceID = &#8216;C:&#8217; or DeviceID = &#8216;D:'&#8221;) &#8216;Set drive to be check  
For Each objDisk in colDisks  
intFreeSpace = objDisk.FreeSpace  
intTotalSpace = objDisk.Size  
pctFreeSpace = intFreeSpace / intTotalSpace  
gbFreeSpace = intFreeSpace / 1073741824  
&#8216;Wscript.Echo FormatPercent(pctFreeSpace)

If gbFreeSpace < 2 Then

Set objMessage = CreateObject("CDO.Message")

objMessage.Subject = "Server Low Disk Space " & objDisk.DeviceID  
objMessage.Sender = "Server13@edomain.it"  
objMessage.To = "email@domain.it"  
objMessage.TextBody = "Server Low Disk Space: " & FormatNumber(gbFreeSpace,0) _  
& "GB remaining. Check disk drives." & vbcrlf _  
& "Message automatically generated by EdScript."

objMessage.Configuration.Fields.Item _  
("http://schemas.microsoft.com/cdo/configuration/sendusing") = 2

objMessage.Configuration.Fields.Item _  
("http://schemas.microsoft.com/cdo/configuration/smtpserver") = "webmail.domain.it"

objMessage.Configuration.Fields.Item _  
("http://schemas.microsoft.com/cdo/configuration/smtpserverport") = 25

objMessage.Configuration.Fields.Item _  
("http://schemas.microsoft.com/cdo/configuration/smtpauthenticate") = 0

objMessage.Configuration.Fields.Item _  
("http://schemas.microsoft.com/cdo/configuration/sendusername") = ""

objMessage.Configuration.Fields.Item _  
("http://schemas.microsoft.com/cdo/configuration/sendpassword") = ""

objMessage.Configuration.Fields.Item _  
("http://schemas.microsoft.com/cdo/configuration/smtpusessl") = False

'set the timeout to 60 seconds.  
'objMessage.Configuration.Fields.Item _  
'("http://schemas.microsoft.com/cdo/configuration/smtpconnectiontimeout") = 60

objMessage.Configuration.Fields.Update  
objMessage.Send

'Wscript.Echo "Message sent successfully."

Else  
'Wscript.Echo "Enough Disk Space."  
End If  
Next